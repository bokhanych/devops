Vagrant.configure("2") do |config|

	config.vm.define "ansible" do |ansible|
		ansible.vm.box = "ubuntu/jammy64"
		ansible.vm.hostname="ansible"
		ansible.vm.network "public_network", ip: "192.168.100.10"
		ansible.vm.provision "shell", inline: <<-SHELL
			# ssh keys
			ssh-keygen -b 2048 -t rsa -f /home/vagrant/.ssh/id_rsa -q -N ""
			cp /home/vagrant/.ssh/id_rsa.pub /vagrant/.vagrant/machines/ansible/virtualbox/id_rsa.pub
			# ansible install
			sudo apt update -y
			sudo apt install ansible -y
			sudo mkdir /etc/ansible
			SHELL
		# ansible config
		ansible.vm.provision "file", source: "/VM/ansible.cfg", destination: "/etc/ansible/"
		# ansible inventory
		ansible.vm.provision "file", source: "/VM/hosts", destination: "/etc/ansible/"
		# ansible playbook
		ansible.vm.provision "file", source: "/VM/apache-playbook.yaml", destination: "/etc/ansible/"
		ansible.vm.provider "virtualbox" do |vb|
			vb.customize ["modifyvm", :id, "--name", "ansible"]
			vb.customize ["modifyvm", :id, "--memory", "1024"]
		end
	end

	config.vm.define "debian" do |debian|
		debian.vm.box = "debian/bullseye64"
		debian.vm.hostname="debian"
        debian.vm.network "public_network", ip: "192.168.100.11"
		debian.vm.provision "shell", inline: <<-SHELL
		# copy ssh master key to authorized_keys:
		sudo cat /vagrant/.vagrant/machines/ansible/virtualbox/id_rsa.pub > /home/vagrant/.ssh/authorized_keys
		SHELL
		debian.vm.provider "virtualbox" do |vb|
			vb.customize ["modifyvm", :id, "--name", "debian"]
			vb.customize ["modifyvm", :id, "--memory", "1024"]
		end
	end
	
	config.vm.define "centos" do |centos|
		centos.vm.box = "centos/8"
		centos.vm.hostname="centos"
        centos.vm.network "public_network", ip: "192.168.100.12"
		centos.vm.provision "shell", inline: <<-SHELL
		# copy ssh master key to authorized_keys:
		sudo cat /vagrant/.vagrant/machines/ansible/virtualbox/id_rsa.pub > /home/vagrant/.ssh/authorized_keys
		SHELL
		centos.vm.provider "virtualbox" do |vb|
			vb.customize ["modifyvm", :id, "--name", "centos"]
			vb.customize ["modifyvm", :id, "--memory", "1024"]
		end
	end
  
end